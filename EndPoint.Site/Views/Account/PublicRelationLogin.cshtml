@using System.Text.Encodings.Web
@inject IHtmlHelper HtmlHelper

@{
    ViewData["Title"] = "PublicRelationLogin";
    Layout = null;
}


<!DOCTYPE html>
<html dir="rtl">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="/PublicRelations/Theme/assets/images/favicon.png">
    <title>SAAS-Public Relations-Login</title>
    <!-- Custom CSS -->
    <link href="/PublicRelations/Theme/dist/css/style.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        .form-control::placeholder {
            font-size: 12px; /* اندازه مورد نظر خود را انتخاب کنید */
        }

    </style>
</head>

<body>
    <div class="main-wrapper">
        <!-- ============================================================== -->
        <!-- Preloader - style you can find in spinners.css -->
        <!-- ============================================================== -->
        <div class="preloader">
            <div class="lds-ripple">
                <div class="lds-pos"></div>
                <div class="lds-pos"></div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- Preloader - style you can find in spinners.css -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Login box.scss -->
        <!-- ============================================================== -->
        <div class="auth-wrapper d-flex no-block justify-content-center align-items-center" style="background:url(/PublicRelations/Theme/assets/images/big/auth-bg.jpg) no-repeat center center;">
            <div class="auth-box">
                <div id="loginform">
                    <div class="logo">
                        <span class="db"><img src="/PublicRelations/Theme/assets/images/logo-icon.png" alt="logo" /></span>
                        <br /><br />
                        <h5 class="font-medium l-b-20" style="font-weight: bold;">سامانه مدیریت آماری روابط عمومی (سماع) </h5>
                        <h6 class="">ورود</h6>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="input-group mb-3">

                                <input type="text" class="form-control form-control-lg" placeholder="شماره پرسنلی" id="UserName" required data-validation-required-message="این فیلد الزامی است">
                            </div>
                            <div class="input-group mb-3">

                                <input type="password" class="form-control form-control-lg" placeholder="رمز عبور" id="Password" required data-validation-required-message="این فیلد الزامی است">
                            </div>
                            <div class="form-group row">
                                <div class="col-md-12">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="customCheck1">
                                        <label class="custom-control-label" for="customCheck1">مرا به خاطر بسپار</label>
                                        <a asp-controller="Account" asp-action="ForgotPassword" class="text-dark float-right"><i class="fa fa-lock m-r-5"></i> فراموشی رمز عبور</></a>

                                    </div>

                                </div>
                            </div>

                            <div class="input-group mb-3">
                                <div style="width: 140px;">
                                    <input type="text" id="captcha" class="form-control form-control-lg" placeholder="کد کپچا" autocomplete="off" required />

                                </div>
                                <div style="margin-right:15px;" id="captchaContainer">
                                    <img src="@Url.Action("ShowCaptcha", "Account")" alt="Captcha" class="ml-2" />

                                </div>
                                <div class="f-icon" id="reloadCaptcha" onclick="reloadCaptcha()"><i class="fas fa-redo"></i></div>
                            </div>


                            <div class="form-group text-center">
                                <div class="col-xs-12 p-b-20">
                                    <button type="button" id="loginButton" class="btn btn-block btn-lg btn-info">ورود</button>

                                </div>
                            </div>

                            <div class="form-group m-b-0 m-t-10">
                                <div class="col-sm-12 text-center">
                                    حساب کاربری ندارید؟ <a asp-controller="Account" asp-action="PublicRelationRegister" class="text-info m-l-5"><b>ثبت نام</b></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- Login box.scss -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Page wrapper scss in scafholding.scss -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Page wrapper scss in scafholding.scss -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Right Sidebar -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Right Sidebar -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- All Required js -->
    <!-- ============================================================== -->
    <script src="/PublicRelations/Theme/assets/libs/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="/PublicRelations/Theme/assets/libs/popper.js/dist/umd/popper.min.js"></script>
    <script src="/PublicRelations/Theme/assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- ============================================================== -->
    <!-- This page plugin js -->
    <!-- ============================================================== -->
    <script>
        $('[data-toggle="tooltip"]').tooltip();
        $(".preloader").fadeOut();
        // ==============================================================
        // Login and Recover Password
        // ==============================================================
        $('#to-recover').on("click", function () {
            $("#loginform").slideUp();
            $("#recoverform").fadeIn();
        });
    </script>

    <link href="~/PublicRelations/Sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="~/PublicRelations/Sweetalert2/sweetalert2.min.js"></script>
    <style>
        .swal-title-small-font {
            font-size: 14px !important; /* اندازه دلخواه فونت */
            font-weight: normal !important; /* اگر خواستی وزن فونت رو هم تنظیم کن */
        }

    </style>

    <script>
        $(document).ready(function () {

            $('#loginButton').on('click', function () {

                // نمایش پیام تایید با استفاده از SweetAlert2
                swal.fire({
                    title: 'ورود کاربر',
                    text: 'آیا از صحت اطلاعات وارد شده اطمینان دارید؟',
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'بله',
                    cancelButtonText: 'خیر'
                }).then((result) => {
                    if (result.value) {
                        var UserName = $("#UserName").val();
                        var Password = $("#Password").val();
                        var IsPersistent = $("#IsPersistent").prop("checked");
                        var captcha = $("#captcha").val();

                        // داده‌هایی که به اکشن ارسال می‌شوند
                        var postData = {
                            'UserName': UserName,
                            'Password': Password,
                            'IsPersistent': IsPersistent,
                            'captcha':captcha
                        }

                        // Check if the required fields are empty
                        if (UserName.trim() === '' || Password.trim() === '') {
                            // Show a SweetAlert error message
                            swal.fire({
                                icon: 'error',
                                title: 'اخطار',
                                text: 'لطفاً تمامی فیلدها را پر کنید.',
                            });
                            return; // Exit the function
                        }


                        // ارسال درخواست AJAX به اکشن مورد نظر
                        $.ajax({

                            beforeSend: function() {
                            // وقتی درخواست شروع میشه، لودینگ رو نمایش بده
                                  Swal.fire({
            title: 'لطفا صبر کنید...',
            allowOutsideClick: false,
            showConfirmButton: false,
            customClass: {
                title: 'swal-title-small-font'
            },
            didOpen: () => {
                Swal.showLoading();
            }
        });

                            },

                            contentType: 'application/x-www-form-urlencoded',
                            dataType: 'json',
                            type: 'POST',
                            url: '@Url.Action("PublicRelationLogin")', // URL اکشن مورد نظر خود را قرار دهید
                            data: postData,
                            success: function (data) {
                                 Swal.close(); // لودینگ قبلی رو می‌بنده

                                if (data.isSuccess == true) {
                                    // اگر لاگین موفقیت‌آمیز بود، نمایش پیام موفقیت‌آمیز با SweetAlert2

                                    swal.fire({
                                        icon: 'success',
                                        title: 'ورود موفقیت‌آمیز',
                                        //html: '<p>در حال انتقال به سامانه</p>',
                                        text: data.message,
                                        timer: 2000,
                                        showConfirmButton: false,
                                        timerProgressBar: true,

                                        onClose: function () {
                                            // Redirect به صفحه مورد نظر بعد از لاگین موفق
                                            window.location.href = data.redirectUrl;
                                        }

                                    });
                                } else {
                                    // اگر لاگین ناموفق بود، نمایش پیام خطا با SweetAlert2
                                    var errorMessages = '<ul>';
                                    $.each(data.errors, function (index, error) {
                                        errorMessages += '<li>' + error + '</li>';
                                    });
                                    errorMessages += '</ul>';
                                    swal.fire({
                                        icon: 'error',
                                        title: 'ورود ناموفق',
                                        text: data.message
                                    });
                                }
                            },
                            error: function () {
                                // در صورت بروز خطا، نمایش پیام خطا با SweetAlert2
                                swal.fire({
                                    icon: 'error',
                                    title: 'ورود ناموفق',
                                    text: 'هنگام ورود به سیستم خطایی رخ داد.',
                                    confirmButtonText: 'بستن'
                                });
                            }
                        });
                    }
                });
            });
        });

    </script>


</body>

</html>




<script>
    document.getElementById("captcha").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
                document.getElementById("loginButton").click();
        }
    });
</script>


<script>
    $(document).ready(function(){
        $('#reloadCaptcha').click(function(){
            // بررسی اینکه آیا مرورگر فایرفاکس است
            if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
                reloadCaptcha(); // استفاده از تابع reloadCaptcha برای فایرفاکس
            } else {
                // انجام عملی برای مرورگرهای دیگر
                console.log("Non-Firefox browser detected.");
                $.ajax({
                    url: '@Url.Action("ShowCaptcha", "Account")',
                    method: 'GET',
                    success: function(data){
                        $('#captchaContainer').load(location.href + " #captchaContainer>*");
                    },
                    error: function(){
                        alert("Error reloading captcha.");
                    }
                });
            }
        });
    });


    function reloadCaptcha() {
        $.ajax({
            url: '@Url.Action("ShowCaptcha", "Account")',
            method: 'GET',
            cache: false,
            success: function() {
                var captchaImg = $("#captchaContainer img");
                var src = captchaImg.attr("src");
                captchaImg.attr("src", src.split("?")[0] + "?t=" + new Date().getTime());
            },
            error: function() {
                alert("خطا در بارگذاری مجدد کپچا.");
            }
        });
    }
</script>








