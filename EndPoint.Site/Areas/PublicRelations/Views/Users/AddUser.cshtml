@{
    ViewData["Title"] = "AddUser";
    Layout = "~/Areas/PublicRelations/Views/Shared/_Layout.cshtml";
}

<div class="page-breadcrumb">
    <div class="row">
        <div class="col-5 align-self-center">
            @*<h4 class="page-title">افزودن کانال جدید</h4>*@
        </div>
        <div class="col-7 align-self-center">
            <div class="d-flex align-items-center justify-content-end">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="#">ورودی ها</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">افزودن کاربر جدید </li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">

    <div class="card">
        <div class="card-header bg-info">
            <h4 class="m-b-0 text-white">افزودن کاربر جدید</h4>
        </div>
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-danger">
                <text>@TempData["Message"]</text>
            </div>
        }

        <div class="form-body">
            <div class="card-body">
                <div id="validationMessages"></div>

                <div class="row p-t-20">
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">نام</label>
                            <input type="text" id="FirstName" class="form-control form-control-danger" placeholder="نام را وارد کنید" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">نام خانوادگی</label>
                            <input type="text" id="LastName" class="form-control form-control-danger" placeholder="نام خانوادگی را وارد کنید" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">شماره پرسنلی</label>
                            <input type="text" id="PersonnelCode" class="form-control form-control-danger" placeholder="شماره پرسنلی را وارد کنید" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">شماره تلفن امین</label>
                            <input type="text" id="PhoneNumber" class="form-control form-control-danger" placeholder="شماره تلفن خط امین را وارد کنید" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">نام استان</label>
                            <select class="form-control" name="Name" asp-items="@ViewBag.Province" id="Province" placeholder="استان" autocomplete="off">
                                <option value="" disabled selected>انتخاب استان</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">نام شهرستان</label>
                            <select class="form-control" id="City" autocomplete="off">
                                <option value="" disabled selected>انتخاب شهرستان</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">پسورد</label>
                            <input type="Password" id="Password" class="form-control form-control-danger" placeholder="پسورد را وارد کنید" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group has-danger">
                            <label class="control-label">پسورد</label>
                            <input type="Password" id="ConfirmPassword" class="form-control form-control-danger" placeholder="تکرار پسورد را وارد کنید" autocomplete="off">
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="form-actions">
            <div class="card-body text-right">
                <button onclick="AddUser()" class="btn btn-info"> <i class="fa fa-check"></i> ذخیره</button>
                <button type="button" class="btn btn-dark">انصراف</button>
            </div>
        </div>

    </div>

    <div class="card  card-hover">
        <div class="card-header bg-info">
            <h4 class="m-b-0 text-white">تولید رمز عبور تصادفی</h4>
        </div>
        <div class="card-body">

            <label><input type="checkbox" id="lowercase" checked> حروف کوچک</label>
            <label><input type="checkbox" id="uppercase" checked> حروف بزرگ</label>
            <label><input type="checkbox" id="numbers" checked> اعداد</label>
            <label><input type="checkbox" id="symbols" checked> علائم</label>
            <button onclick="generatePassword()" class="btn waves-effect waves-light btn-success">تولید رمز عبور</button>
            <div class="badge badge-danger" id="password" onclick="copyToClipboard()">رمز عبور در اینجا نمایش داده می‌شود</div>


        </div>
    </div>



    <script>
        function generatePassword() {
            const length = 12;
            let charset = "";
            if (document.getElementById('lowercase').checked) charset += "abcdefghijklmnopqrstuvwxyz";
            if (document.getElementById('uppercase').checked) charset += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            if (document.getElementById('numbers').checked) charset += "0123456789";
            if (document.getElementById('symbols').checked) charset += "!@@#$%^&*()_+~`|}{[]:;?><,./-=";

            if (charset === "") {
                Swal.fire({
                    icon: "error",
                    text: "لطفاً حداقل یک نوع کاراکتر را انتخاب کنید!",
                    confirmButtonText: "متوجه شدم",
                
                });
                return;
            }

            let password = "";
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                password += charset[randomIndex];
            }

            document.getElementById('password').textContent = password;
        }

        function copyToClipboard() {
            const passwordText = document.getElementById('password').textContent;
            if (passwordText && passwordText !== "رمز عبور در اینجا نمایش داده می‌شود") {
                navigator.clipboard.writeText(passwordText).then(function () {
                    Swal.fire({
                        icon: "success",
                        title: "رمز عبور کپی شد!",
                        showConfirmButton: false,
                        timer: 1500


                    });

                }, function (err) {
                    console.error("خطا در کپی کردن: ", err);
                });
            }
        }
    </script>





</div>

<script src="/PublicRelations/Theme/assets/libs/jquery/dist/jquery.min.js "></script>
<script src="/PublicRelations/Theme/assets/libs/popper.js/dist/umd/popper.min.js "></script>
<script src="/PublicRelations/Theme/assets/libs/bootstrap/dist/js/bootstrap.min.js "></script>
<script>
    $('[data-toggle="tooltip "]').tooltip();
    $(".preloader ").fadeOut();
</script>

 <link href="~/PublicRelations/Sweetalert2/sweetalert2.min.css" rel="stylesheet" />
 <script src="~/PublicRelations/Sweetalert2/sweetalert2.min.js"></script>

<script>
    function AddUser() {
        var FirstName = $("#FirstName").val();
        var LastName = $("#LastName").val();
        var PersonnelCode = $("#PersonnelCode").val();
        var PhoneNumber = $("#PhoneNumber").val();
        var Province = $("#Province").val();
        var City = $("#City").val();
        var Password = $("#Password").val();
        var ConfirmPassword = $("#ConfirmPassword").val();

        var errors = [];

        // اعتبارسنجی نام
        if (FirstName.length < 1) {
            errors.push("نام را وارد کنید.");
        }

        // اعتبارسنجی نام خانوادگی
        if (LastName.length < 1) {
            errors.push("نام خانوادگی را وارد کنید.");
        }

        // اعتبارسنجی کد پرسنلی
        if (PersonnelCode.length < 9) {
            errors.push("لطفا یک شماره پرسنلی معتبر وارد کنید.");
        }

        // الگو برای شماره تلفن همراه ایران
        var phoneNumberPattern = /^(?:\d{5}|\d{8})$/;

        // اعتبارسنجی شماره تلفن
        if (!phoneNumberPattern.test(PhoneNumber)) {
            errors.push("لطفاً یک شماره تلفن معتبر وارد کنید.");
        }

        // اعتبارسنجی استان
        if (Province == null) {
            errors.push("استان را انتخاب کنید.");
        }

        // اعتبارسنجی شهرستان
        if (City == null) {
            errors.push("شهرستان را انتخاب کنید.");
        }

        // اعتبارسنجی پسورد
        if (Password.length < 6) {
            errors.push("پسورد باید حداقل 6 کاراکتر باشد.");
        }

        // اعتبارسنجی تکرار پسورد
        if (Password !== ConfirmPassword) {
            errors.push("تکرار پسورد مطابقت ندارد.");
        }

        if (errors.length > 0) {
            var errorHtml = '<ul>';
            for (var i = 0; i < errors.length; i++) {
                errorHtml += '<li>' + errors[i] + '</li>';
            }
            errorHtml += '</ul>';
            $('#validationMessages').html('<div class="alert alert-danger alert-rounded">' + errorHtml + '</div>');
        } else {
            // اگر همه اعتبارسنجی‌ها موفق بودند، نمایش الرت
            showConfirmationAlert();
        }
    }

    function showConfirmationAlert() {
        swal.fire({
            title: 'ثبت اطلاعات',
            text: 'آیا از صحت اطلاعات وارد شده اطمینان دارید؟',
            icon: 'info',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'بله',
            cancelButtonText: 'خیر'
        }).then((result) => {
            if (result.value) {
                // اگر کاربر "بله" را انتخاب کند، ادامه عملیات ثبت نام
                submitRegistration();
            }
        });
    }

    function submitRegistration() {
        var FirstName = $("#FirstName").val();
        var LastName = $("#LastName").val();
        var PersonnelCode = $("#PersonnelCode").val();
        var PhoneNumber = $("#PhoneNumber").val();
        var Province = $("#Province").val();
        var City = $("#City").val();
        var Password = $("#Password").val();
        var ConfirmPassword = $("#ConfirmPassword").val();

        var postData = {
            'FirstName': FirstName,
            'LastName': LastName,
            'PersonnelCode': PersonnelCode,
            'PhoneNumber': PhoneNumber,
            'Province': Province,
            'City': City,
            'Password': Password,
            'ConfirmPassword': ConfirmPassword,
        };

        $.ajax({
            contentType: 'application/x-www-form-urlencoded',
            dataType: 'json',
            type: "POST",
            url: "AddUser", // تغییر به URL درخواست به وب‌سرور
            data: postData,
            success: function (data) {
                if (data.isSuccess == true) {
                    swal.fire({
                        title: 'موفق!',
                        text: data.message,
                        icon: 'success',
                        showConfirmButton: false,
                    });
                    setTimeout(function () {
                        window.location.href = '/PublicRelations/Users/AddUser';
                    }, 1000); // 1 ثانیه
                } else {
                    swal.fire(
                        'هشدار!',
                        data.message,
                        'warning'
                    );
                }
            },
            error: function (request, status, error) {
                // نمایش پیام خطا در کنسول
                console.error("خطا در درخواست:", request.responseText);
            }
        });
    }

</script>

 <script>
    $(document).ready(function () {
        $('#Province').change(function () {
            var selectedProvinceId = $(this).val();

            // اگر استان انتخاب نشده باشد، خالی کنید
            if (!selectedProvinceId) {
                $('#City').empty();
                return;
            }


            $.ajax({
                url: '/Account/GetCitiesByProvinceId?provinceId=' + selectedProvinceId,
                type: 'GET',
                success: function (data) {
                    // بازیابی اطلاعات شهرستان‌ها و به‌روز کردن المان دراپ‌دان شهرستان
                    var cityDropdown = $('#City');
                    cityDropdown.empty();
                    $.each(data, function (i, item) {
                        cityDropdown.append($('<option></option>').val(item.value).text(item.text));
                    });
                },
                error: function () {
                    alert('خطا در دریافت اطلاعات شهرستان‌ها.');
                }
            });
        });
    });

</script> 




@section Scripts {

}
